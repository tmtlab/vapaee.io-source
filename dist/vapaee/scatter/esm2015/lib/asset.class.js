/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import BigNumber from "bignumber.js";
import { Token } from "./token.class";
export class Asset {
    /**
     * @param {?=} a
     * @param {?=} b
     */
    constructor(a = null, b = null) {
        if (a == null && b == null) {
            this.amount = new BigNumber(0);
            this.token = new Token();
            return;
        }
        if (a instanceof BigNumber) {
            this.amount = a;
            this.token = b;
            return;
        }
        if (a instanceof Asset) {
            this.amount = a.amount;
            this.token = b;
            return;
        }
        if (typeof a == "number") {
            this.amount = new BigNumber(a);
            this.token = b;
            return;
        }
        if (typeof a == "string") {
            this.parse(a);
            console.assert(this.amount instanceof BigNumber, "ERROR: Asset string malformed: '" + a + "'");
            return;
        }
    }
    /**
     * @param {?} b
     * @return {?}
     */
    plus(b) {
        console.assert(!!b, "ERROR: b is not an Asset", b, this.str);
        console.assert(b.token.symbol == this.token.symbol, "ERROR: trying to sum assets with different tokens: " + this.str + " and " + b.str);
        /** @type {?} */
        var amount = this.amount.plus(b.amount);
        return new Asset(amount, this.token);
    }
    /**
     * @param {?} b
     * @return {?}
     */
    minus(b) {
        console.assert(!!b, "ERROR: b is not an Asset", b, this.str);
        console.assert(b.token.symbol == this.token.symbol, "ERROR: trying to substract assets with different tokens: " + this.str + " and " + b.str);
        /** @type {?} */
        var amount = this.amount.minus(b.amount);
        return new Asset(amount, this.token);
    }
    /**
     * @return {?}
     */
    clone() {
        return new Asset(this.amount, this.token);
    }
    /**
     * @param {?} text
     * @return {?}
     */
    parse(text) {
        if (text == "")
            return;
        /** @type {?} */
        var sym = text.split(" ")[1];
        /** @type {?} */
        var amount_str = text.split(" ")[0];
        this.amount = new BigNumber(amount_str);
        /** @type {?} */
        var precision = 0;
        if (amount_str.split(".").length == 2) {
            precision = amount_str.split(".")[1].length;
        }
        else if (amount_str.split(".").length == 1) {
            if (isNaN(parseInt(amount_str))) {
                console.error("ERROR: Asset malformed string: '" + text + "'");
            }
        }
        this.token = new Token({
            symbol: sym,
            precision: precision
        });
    }
    /**
     * @param {?=} decimals
     * @param {?=} total
     * @return {?}
     */
    valueToString(decimals = -1, total = false) {
        if (!this.token)
            return "0";
        /** @type {?} */
        var parts = this.amount.toFixed().split(".");
        /** @type {?} */
        var integer = parts[0];
        /** @type {?} */
        var precision = this.token.precision;
        /** @type {?} */
        var decimal = (parts.length == 2 ? parts[1] : "");
        if (decimals != -1) {
            precision = decimals;
        }
        if (total) {
            precision -= parts[0].length - 1;
            precision = precision > 0 ? precision : 0;
        }
        for (var i = decimal.length; i < precision; i++) {
            decimal += "0";
        }
        if (decimal.length > precision) {
            decimal = decimal.substr(0, precision);
        }
        if (precision == 0) {
            return integer;
        }
        else {
            return integer + "." + decimal;
        }
    }
    /**
     * @return {?}
     */
    toNumber() {
        if (!this.token)
            return 0;
        return parseFloat(this.valueToString(8));
    }
    /**
     * @return {?}
     */
    get str() {
        return this.toString();
    }
    /**
     * @param {?=} decimals
     * @return {?}
     */
    toString(decimals = -1) {
        if (!this.token)
            return "0.0000";
        return this.valueToString(decimals) + " " + this.token.symbol.toUpperCase();
    }
    /**
     * @param {?} token
     * @return {?}
     */
    inverse(token) {
        /** @type {?} */
        var result = new BigNumber(1).dividedBy(this.amount);
        /** @type {?} */
        var asset = new Asset(result, token);
        return asset;
    }
}
if (false) {
    /** @type {?} */
    Asset.prototype.amount;
    /** @type {?} */
    Asset.prototype.token;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXNzZXQuY2xhc3MuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdmFwYWVlL3NjYXR0ZXIvIiwic291cmNlcyI6WyJsaWIvYXNzZXQuY2xhc3MudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sU0FBUyxNQUFNLGNBQWMsQ0FBQztBQUNyQyxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRXRDLE1BQU07Ozs7O0lBSUYsWUFBWSxJQUFTLElBQUksRUFBRSxJQUFTLElBQUk7UUFDcEMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQztZQUN6QixJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQy9CLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxLQUFLLEVBQUUsQ0FBQztZQUN6QixNQUFNLENBQUM7U0FDVjtRQUVELEVBQUUsQ0FBQyxDQUFDLENBQUMsWUFBWSxTQUFTLENBQUMsQ0FBQyxDQUFDO1lBQ3pCLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1lBQ2hCLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO1lBQ2YsTUFBTSxDQUFDO1NBQ1Y7UUFFRCxFQUFFLENBQUMsQ0FBQyxDQUFDLFlBQVksS0FBSyxDQUFDLENBQUMsQ0FBQztZQUNyQixJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUM7WUFDdkIsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUM7WUFDZixNQUFNLENBQUM7U0FDVjtRQUVELEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLFFBQVEsQ0FBQyxDQUFDLENBQUM7WUFDdkIsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMvQixJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztZQUNmLE1BQU0sQ0FBQztTQUNWO1FBRUQsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksUUFBUSxDQUFDLENBQUMsQ0FBQztZQUN2QixJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2QsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxZQUFZLFNBQVMsRUFBRSxrQ0FBa0MsR0FBQyxDQUFDLEdBQUMsR0FBRyxDQUFDLENBQUM7WUFDM0YsTUFBTSxDQUFDO1NBQ1Y7S0FDSjs7Ozs7SUFFRCxJQUFJLENBQUMsQ0FBTztRQUNSLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSwwQkFBMEIsRUFBRSxDQUFDLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzdELE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUscURBQXFELEdBQUcsSUFBSSxDQUFDLEdBQUcsR0FBRyxPQUFPLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDOztRQUN4SSxJQUFJLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDeEMsTUFBTSxDQUFDLElBQUksS0FBSyxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7S0FDeEM7Ozs7O0lBRUQsS0FBSyxDQUFDLENBQU87UUFDVCxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsMEJBQTBCLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUM3RCxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLDJEQUEyRCxHQUFHLElBQUksQ0FBQyxHQUFHLEdBQUcsT0FBTyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQzs7UUFDOUksSUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3pDLE1BQU0sQ0FBQyxJQUFJLEtBQUssQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0tBQ3hDOzs7O0lBRUQsS0FBSztRQUNELE1BQU0sQ0FBQyxJQUFJLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztLQUM3Qzs7Ozs7SUFFRCxLQUFLLENBQUMsSUFBWTtRQUNkLEVBQUUsQ0FBQyxDQUFDLElBQUksSUFBSSxFQUFFLENBQUM7WUFBQyxNQUFNLENBQUM7O1FBQ3ZCLElBQUksR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7O1FBQzdCLElBQUksVUFBVSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDcEMsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLFNBQVMsQ0FBQyxVQUFVLENBQUMsQ0FBQzs7UUFFeEMsSUFBSSxTQUFTLEdBQUcsQ0FBQyxDQUFDO1FBQ2xCLEVBQUUsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDcEMsU0FBUyxHQUFHLFVBQVUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO1NBQy9DO1FBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDM0MsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztn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QyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7O1FBQ3JELElBQUksS0FBSyxHQUFJLElBQUksS0FBSyxDQUFDLE1BQU0sRUFBRSxLQUFLLENBQUMsQ0FBQztRQUN0QyxNQUFNLENBQUMsS0FBSyxDQUFDO0tBQ2hCO0NBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQmlnTnVtYmVyIGZyb20gXCJiaWdudW1iZXIuanNcIjtcbmltcG9ydCB7IFRva2VuIH0gZnJvbSBcIi4vdG9rZW4uY2xhc3NcIjtcblxuZXhwb3J0IGNsYXNzIEFzc2V0IHtcbiAgICBhbW91bnQ6QmlnTnVtYmVyO1xuICAgIHRva2VuOlRva2VuO1xuICAgIFxuICAgIGNvbnN0cnVjdG9yKGE6IGFueSA9IG51bGwsIGI6IGFueSA9IG51bGwpIHtcbiAgICAgICAgaWYgKGEgPT0gbnVsbCAmJiBiID09IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuYW1vdW50ID0gbmV3IEJpZ051bWJlcigwKTtcbiAgICAgICAgICAgIHRoaXMudG9rZW4gPSBuZXcgVG9rZW4oKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChhIGluc3RhbmNlb2YgQmlnTnVtYmVyKSB7XG4gICAgICAgICAgICB0aGlzLmFtb3VudCA9IGE7XG4gICAgICAgICAgICB0aGlzLnRva2VuID0gYjtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChhIGluc3RhbmNlb2YgQXNzZXQpIHtcbiAgICAgICAgICAgIHRoaXMuYW1vdW50ID0gYS5hbW91bnQ7XG4gICAgICAgICAgICB0aGlzLnRva2VuID0gYjtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0eXBlb2YgYSA9PSBcIm51bWJlclwiKSB7XG4gICAgICAgICAgICB0aGlzLmFtb3VudCA9IG5ldyBCaWdOdW1iZXIoYSk7XG4gICAgICAgICAgICB0aGlzLnRva2VuID0gYjtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0eXBlb2YgYSA9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICB0aGlzLnBhcnNlKGEpO1xuICAgICAgICAgICAgY29uc29sZS5hc3NlcnQodGhpcy5hbW91bnQgaW5zdGFuY2VvZiBCaWdOdW1iZXIsIFwiRVJST1I6IEFzc2V0IHN0cmluZyBtYWxmb3JtZWQ6ICdcIithK1wiJ1wiKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHBsdXMoYjpBc3NldCkge1xuICAgICAgICBjb25zb2xlLmFzc2VydCghIWIsIFwiRVJST1I6IGIgaXMgbm90IGFuIEFzc2V0XCIsIGIsIHRoaXMuc3RyKTtcbiAgICAgICAgY29uc29sZS5hc3NlcnQoYi50b2tlbi5zeW1ib2wgPT0gdGhpcy50b2tlbi5zeW1ib2wsIFwiRVJST1I6IHRyeWluZyB0byBzdW0gYXNzZXRzIHdpdGggZGlmZmVyZW50IHRva2VuczogXCIgKyB0aGlzLnN0ciArIFwiIGFuZCBcIiArIGIuc3RyKTtcbiAgICAgICAgdmFyIGFtb3VudCA9IHRoaXMuYW1vdW50LnBsdXMoYi5hbW91bnQpO1xuICAgICAgICByZXR1cm4gbmV3IEFzc2V0KGFtb3VudCwgdGhpcy50b2tlbik7XG4gICAgfVxuXG4gICAgbWludXMoYjpBc3NldCkge1xuICAgICAgICBjb25zb2xlLmFzc2VydCghIWIsIFwiRVJST1I6IGIgaXMgbm90IGFuIEFzc2V0XCIsIGIsIHRoaXMuc3RyKTtcbiAgICAgICAgY29uc29sZS5hc3NlcnQoYi50b2tlbi5zeW1ib2wgPT0gdGhpcy50b2tlbi5zeW1ib2wsIFwiRVJST1I6IHRyeWluZyB0byBzdWJzdHJhY3QgYXNzZXRzIHdpdGggZGlmZmVyZW50IHRva2VuczogXCIgKyB0aGlzLnN0ciArIFwiIGFuZCBcIiArIGIuc3RyKTtcbiAgICAgICAgdmFyIGFtb3VudCA9IHRoaXMuYW1vdW50Lm1pbnVzKGIuYW1vdW50KTtcbiAgICAgICAgcmV0dXJuIG5ldyBBc3NldChhbW91bnQsIHRoaXMudG9rZW4pO1xuICAgIH1cblxuICAgIGNsb25lKCk6IEFzc2V0IHtcbiAgICAgICAgcmV0dXJuIG5ldyBBc3NldCh0aGlzLmFtb3VudCwgdGhpcy50b2tlbik7XG4gICAgfVxuXG4gICAgcGFyc2UodGV4dDogc3RyaW5nKSB7XG4gICAgICAgIGlmICh0ZXh0ID09IFwiXCIpIHJldHVybjtcbiAgICAgICAgdmFyIHN5bSA9IHRleHQuc3BsaXQoXCIgXCIpWzFdO1xuICAgICAgICB2YXIgYW1vdW50X3N0ciA9IHRleHQuc3BsaXQoXCIgXCIpWzBdO1xuICAgICAgICB0aGlzLmFtb3VudCA9IG5ldyBCaWdOdW1iZXIoYW1vdW50X3N0cik7XG5cbiAgICAgICAgdmFyIHByZWNpc2lvbiA9IDA7XG4gICAgICAgIGlmIChhbW91bnRfc3RyLnNwbGl0KFwiLlwiKS5sZW5ndGggPT0gMikge1xuICAgICAgICAgICAgcHJlY2lzaW9uID0gYW1vdW50X3N0ci5zcGxpdChcIi5cIilbMV0ubGVuZ3RoO1xuICAgICAgICB9IGVsc2UgaWYgKGFtb3VudF9zdHIuc3BsaXQoXCIuXCIpLmxlbmd0aCA9PSAxKSB7XG4gICAgICAgICAgICBpZiAoaXNOYU4ocGFyc2VJbnQoYW1vdW50X3N0cikpKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkVSUk9SOiBBc3NldCBtYWxmb3JtZWQgc3RyaW5nOiAnXCIrdGV4dCtcIidcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHRoaXMudG9rZW4gPSBuZXcgVG9rZW4oe1xuICAgICAgICAgICAgc3ltYm9sOiBzeW0sXG4gICAgICAgICAgICBwcmVjaXNpb246IHByZWNpc2lvblxuICAgICAgICB9KTsgXG4gICAgfVxuXG4gICAgdmFsdWVUb1N0cmluZyhkZWNpbWFsczpudW1iZXIgPSAtMSwgdG90YWw6Ym9vbGVhbiA9IGZhbHNlKTogc3RyaW5nIHtcbiAgICAgICAgaWYgKCF0aGlzLnRva2VuKSByZXR1cm4gXCIwXCI7XG4gICAgICAgIHZhciBwYXJ0cyA9IHRoaXMuYW1vdW50LnRvRml4ZWQoKS5zcGxpdChcIi5cIik7XG4gICAgICAgIHZhciBpbnRlZ2VyID0gcGFydHNbMF07XG4gICAgICAgIHZhciBwcmVjaXNpb24gPSB0aGlzLnRva2VuLnByZWNpc2lvbjtcbiAgICAgICAgdmFyIGRlY2ltYWwgPSAocGFydHMubGVuZ3RoPT0yID8gcGFydHNbMV0gOiBcIlwiKTtcbiAgICAgICAgaWYgKGRlY2ltYWxzICE9IC0xKSB7XG4gICAgICAgICAgICBwcmVjaXNpb24gPSBkZWNpbWFscztcbiAgICAgICAgfVxuICAgICAgICBpZiAodG90YWwpIHtcbiAgICAgICAgICAgIHByZWNpc2lvbiAtPSBwYXJ0c1swXS5sZW5ndGgtMTtcbiAgICAgICAgICAgIHByZWNpc2lvbiA9IHByZWNpc2lvbiA+IDAgPyBwcmVjaXNpb24gOiAwO1xuICAgICAgICB9XG4gICAgICAgIGZvciAodmFyIGk9ZGVjaW1hbC5sZW5ndGg7IGk8cHJlY2lzaW9uOyBpKyspIHtcbiAgICAgICAgICAgIGRlY2ltYWwgKz0gXCIwXCI7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRlY2ltYWwubGVuZ3RoID4gcHJlY2lzaW9uKSB7XG4gICAgICAgICAgICBkZWNpbWFsID0gZGVjaW1hbC5zdWJzdHIoMCwgcHJlY2lzaW9uKTtcbiAgICAgICAgfSAgICBcblxuICAgICAgICBpZiAocHJlY2lzaW9uID09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBpbnRlZ2VyO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGludGVnZXIgKyBcIi5cIiArIGRlY2ltYWw7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB0b051bWJlcigpIHtcbiAgICAgICAgaWYgKCF0aGlzLnRva2VuKSByZXR1cm4gMDtcbiAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQodGhpcy52YWx1ZVRvU3RyaW5nKDgpKTtcbiAgICB9XG5cbiAgICBnZXQgc3RyICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudG9TdHJpbmcoKTtcbiAgICB9XG5cbiAgICB0b1N0cmluZyhkZWNpbWFsczpudW1iZXIgPSAtMSk6IHN0cmluZyB7XG4gICAgICAgIGlmICghdGhpcy50b2tlbikgcmV0dXJuIFwiMC4wMDAwXCI7XG4gICAgICAgIHJldHVybiB0aGlzLnZhbHVlVG9TdHJpbmcoZGVjaW1hbHMpICsgXCIgXCIgKyB0aGlzLnRva2VuLnN5bWJvbC50b1VwcGVyQ2FzZSgpO1xuICAgIH1cblxuICAgIGludmVyc2UodG9rZW46IFRva2VuKTogQXNzZXQge1xuICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IEJpZ051bWJlcigxKS5kaXZpZGVkQnkodGhpcy5hbW91bnQpO1xuICAgICAgICB2YXIgYXNzZXQgPSAgbmV3IEFzc2V0KHJlc3VsdCwgdG9rZW4pO1xuICAgICAgICByZXR1cm4gYXNzZXQ7XG4gICAgfVxufSJdfQ==